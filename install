shutt() {
    { "$@" || return $?; } | while read -r line; do
        :
    done
}


downloadytdl() {
    curl -o $PREFIX/bin/ytdl -fsSL https://bit.ly/ytdl-main
    curl -o $PREFIX/etc/ytdlversion -fsSL https://bit.ly/ytdl-version
    chmod +x $PREFIX/bin/ytdl
}


installytdl() {
    shutt pkg install python -y 2> /dev/null
    shutt pkg install ffmpeg -y 2> /dev/null
    downloadytdl
    echo Installation successful
}


updateytdl() {
    rm $PREFIX/bin/ytdl $PREFIX/etc/ytdlversion
    downloadytdl
    echo Updated successfully
}


shutt apt update -y 2> /dev/null
shutt apt upgrade -y 2> /dev/null
pip -qq install -U pip
pip -qq install -U yt-dlp
pip -qq install -U spotify_dl


if [[ -f $PREFIX/bin/ytdl ]]
then
    if ! [[ -f $PREFIX/etc/ytdlversion ]]
    then
        rm $PREFIX/bin/ytdl
        installytdl
    else
        v=$(curl -fsSL https://bit.ly/ytdl-version)
        cv=$(sed -n '1p' $PREFIX/etc/ytdlversion)
        if ! [[ v -eq cv ]]
        then
            updateytdl
        else
            echo Already Upto Date
        fi
    fi
else
    installytdl
fi
